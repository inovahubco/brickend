{# main_template.j2
   Generates `app/main.py` mounting all routers from `app/routers` #}

from fastapi import FastAPI
from app.database import engine, Base

{% for entity in entities %}
from app.routers.{{ entity.names.snake }}_router import router as {{ entity.names.snake }}_router
{% endfor %}

app = FastAPI(
    title="{{ project_name | default('FastAPI App') }}",
    version="{{ project_version | default('0.1.0') }}"
)

{% for entity in entities %}
app.include_router(
    {{ entity.names.snake }}_router,
    prefix="/{{ entity.names.kebab }}s",
    tags=["{{ entity.names.pascal }}"]
)
{% endfor %}

@app.on_event("startup")
def on_startup():
    """
    Create all tables in the database on startup.
    """
    Base.metadata.create_all(bind=engine)


@app.get("/", tags=["root"])
def read_root():
    return {"message": "Welcome to {{ project_name | default('your app') }}!"}
